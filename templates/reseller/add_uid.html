{% extends 'base.html' %}

{% block title %}Add UID - Mani 272{% endblock %}

{% block content %}
<h1 style="color: white; margin-bottom: 2rem;">Add New UID</h1>

<div
    style="background: rgba(0, 247, 255, 0.1); padding: 1.2rem 2rem; border-radius: 12px; margin-bottom: 2rem; border: 2px solid rgba(0, 247, 255, 0.3); text-align: center;">
    <strong style="color: var(--text); font-size: 1.1rem;">üí∞ Available Credits:</strong>
    <span style="color: var(--success); font-size: 1.5rem; font-weight: 700; margin-left: 1rem;">‚Çπ{{
        "%.2f"|format(credits) }}</span>
</div>

<div class="card" style="max-width: 800px;">
    <h2 style="margin-bottom: 1.5rem;">UID Details</h2>

    <form method="POST">
        <div class="form-grid-2">
            <div class="form-group">
                <label for="uid">UID *</label>
                <input type="text" id="uid" name="uid" placeholder="Enter UID number" required>
            </div>

            <div class="form-group">
                <label for="uid_name">UID Owner Name *</label>
                <input type="text" id="uid_name" name="uid_name" placeholder="Enter name" required>
            </div>
        </div>

        <div class="form-group">
            <label for="region">Region *</label>
            <select id="region" name="region" required>
                <option value="">Select Region</option>
                {% for r in regions %}
                <option value="{{ r }}">{{ r }}</option>
                {% endfor %}
            </select>
        </div>

        <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--text);">‚è±Ô∏è Duration</h3>

        <div class="form-grid-4">
            <div class="form-group">
                <label for="years">Years</label>
                <select id="years" name="years" onchange="calculateCredits()">
                    {% for i in range(6) %}
                    <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="months">Months</label>
                <select id="months" name="months" onchange="calculateCredits()">
                    {% for i in range(13) %}
                    <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="days">Days</label>
                <input type="number" id="days" name="days" value="0" min="0" max="365" onchange="calculateCredits()">
            </div>

            <div class="form-group">
                <label for="hours">Hours</label>
                <input type="number" id="hours" name="hours" value="0" min="0" max="23" onchange="calculateCredits()">
            </div>
        </div>

        <div
            style="background: rgba(0, 247, 255, 0.08); padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0; border: 1px solid rgba(0, 247, 255, 0.3);">
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; text-align: center;">
                <div>
                    <strong style="color: var(--text); display: block; margin-bottom: 0.5rem;">Total Duration:</strong>
                    <span id="totalDuration" style="color: var(--primary); font-size: 1.3rem; font-weight: 700;">0
                        days</span>
                </div>
                <div>
                    <strong style="color: var(--text); display: block; margin-bottom: 0.5rem;">Credits
                        Required:</strong>
                    <span id="creditsRequired"
                        style="color: var(--warning); font-size: 1.3rem; font-weight: 700;">‚Çπ0.00</span>
                </div>
                <div>
                    <strong style="color: var(--text); display: block; margin-bottom: 0.5rem;">After Purchase:</strong>
                    <span id="creditsAfter" style="color: var(--success); font-size: 1.3rem; font-weight: 700;">‚Çπ{{
                        "%.2f"|format(credits) }}</span>
                </div>
            </div>

            <div id="insufficientWarning"
                style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(255, 0, 85, 0.15); color: var(--danger); border-radius: 8px; text-align: center; border: 1px solid var(--danger);">
                ‚ö†Ô∏è Insufficient credits! Contact owner to add more credits.
            </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-success" id="submitBtn">Add UID</button>
            <a href="{{ url_for('reseller_my_uids') }}" class="btn btn-danger">Cancel</a>
        </div>
    </form>
</div>

<script>
    const availableCredits = {{ credits }};

    function calculateCredits() {
        const years = parseInt(document.getElementById('years').value) || 0;
        const months = parseInt(document.getElementById('months').value) || 0;
        const days = parseInt(document.getElementById('days').value) || 0;
        const hours = parseInt(document.getElementById('hours').value) || 0;

        const totalDays = (years * 365) + (months * 30) + days + (hours / 24);
        const creditsNeeded = totalDays * 0.15;
        const creditsRemaining = availableCredits - creditsNeeded;

        document.getElementById('totalDuration').textContent = totalDays.toFixed(1) + ' days';
        document.getElementById('creditsRequired').textContent = '‚Çπ' + creditsNeeded.toFixed(2);
        document.getElementById('creditsAfter').textContent = '‚Çπ' + creditsRemaining.toFixed(2);

        // Check if sufficient credits
        const submitBtn = document.getElementById('submitBtn');
        const warning = document.getElementById('insufficientWarning');

        if (creditsNeeded > availableCredits) {
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';
            submitBtn.style.cursor = 'not-allowed';
            warning.style.display = 'block';
            document.getElementById('creditsAfter').style.color = '#e74c3c';
        } else {
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor = 'pointer';
            warning.style.display = 'none';
            document.getElementById('creditsAfter').style.color = creditsRemaining < 10 ? '#f39c12' : '#2ecc71';
        }
    }

    // Initial calculation
    calculateCredits();
</script>
{% endblock %}